<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZimaOS Port Monitor</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <h1><i class="fas fa-network-wired"></i> Port Monitor</h1>
                    <span class="status-indicator" id="connectionStatus">
                        <span class="status-dot"></span>
                        <span class="status-text">Connecting...</span>
                    </span>
                </div>
                <div class="header-right">
                    <button class="btn btn-icon" id="themeToggle" title="Toggle Theme">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="btn btn-icon" id="refreshBtn" title="Refresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="btn btn-icon" id="settingsBtn" title="Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </header>

        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="ports">
                <i class="fas fa-plug"></i> Active Ports
            </button>
            <button class="nav-tab" data-tab="security">
                <i class="fas fa-shield-alt"></i> Security
                <span class="badge badge-danger" id="alertCount" style="display: none;">0</span>
            </button>
            <button class="nav-tab" data-tab="traffic">
                <i class="fas fa-chart-line"></i> Traffic
            </button>
            <button class="nav-tab" data-tab="topology">
                <i class="fas fa-project-diagram"></i> Topology
            </button>
            <button class="nav-tab" data-tab="docker">
                <i class="fab fa-docker"></i> Containers
            </button>
        </nav>

        <div class="search-filter-bar">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search ports, processes, or containers...">
            </div>
            <div class="filter-controls">
                <select id="protocolFilter" class="filter-select">
                    <option value="">All Protocols</option>
                    <option value="tcp">TCP</option>
                    <option value="udp">UDP</option>
                </select>
                <select id="typeFilter" class="filter-select">
                    <option value="">All Types</option>
                    <option value="system">System</option>
                    <option value="docker">Docker</option>
                    <option value="user">User</option>
                </select>
                <button class="btn btn-sm" id="exportBtn">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>

        <main class="main-content">
            <div class="tab-content active" id="ports-tab">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-server"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalPorts">0</div>
                            <div class="stat-label">Active Ports</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-link"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalConnections">0</div>
                            <div class="stat-label">Connections</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fab fa-docker"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="dockerPorts">0</div>
                            <div class="stat-label">Container Ports</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-exchange-alt"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="trafficRate">0 B/s</div>
                            <div class="stat-label">Traffic Rate</div>
                        </div>
                    </div>
                </div>

                <div class="ports-table-container">
                    <table class="ports-table" id="portsTable">
                        <thead>
                            <tr>
                                <th>Port</th>
                                <th>Protocol</th>
                                <th>Process</th>
                                <th>PID</th>
                                <th>Container</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="portsTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="security-tab">
                <div class="security-overview">
                    <div class="alert-summary">
                        <h3>Security Alerts</h3>
                        <div class="alert-stats">
                            <span class="alert-stat critical">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span id="criticalCount">0</span> Critical
                            </span>
                            <span class="alert-stat high">
                                <i class="fas fa-exclamation-circle"></i>
                                <span id="highCount">0</span> High
                            </span>
                            <span class="alert-stat medium">
                                <i class="fas fa-info-circle"></i>
                                <span id="mediumCount">0</span> Medium
                            </span>
                            <span class="alert-stat low">
                                <i class="fas fa-check-circle"></i>
                                <span id="lowCount">0</span> Low
                            </span>
                        </div>
                    </div>
                </div>

                <div class="alerts-list" id="alertsList">
                </div>

                <div id="geoVisualization"></div>

                <div class="whitelist-section">
                    <h3>Whitelist Management</h3>
                    <div class="whitelist-controls">
                        <input type="number" id="whitelistPort" placeholder="Port number">
                        <input type="text" id="whitelistProcess" placeholder="Process name (optional)">
                        <button class="btn btn-primary" id="addWhitelistBtn">Add to Whitelist</button>
                    </div>
                    <div class="whitelist-items" id="whitelistItems">
                    </div>
                </div>
            </div>

            <div class="tab-content" id="traffic-tab">
                <div class="analytics-controls">
                    <select id="analyticsPeriod" class="filter-select">
                        <option value="1h">Last Hour</option>
                        <option value="24h" selected>Last 24 Hours</option>
                        <option value="7d">Last 7 Days</option>
                        <option value="30d">Last 30 Days</option>
                    </select>
                    <button class="btn btn-sm" id="refreshAnalytics">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>

                <div class="analytics-summary">
                    <div class="summary-card">
                        <h4>Total Traffic In</h4>
                        <div class="summary-value" id="totalTrafficIn">0 MB</div>
                    </div>
                    <div class="summary-card">
                        <h4>Total Traffic Out</h4>
                        <div class="summary-value" id="totalTrafficOut">0 MB</div>
                    </div>
                    <div class="summary-card">
                        <h4>Avg Active Ports</h4>
                        <div class="summary-value" id="avgActivePorts">0</div>
                    </div>
                    <div class="summary-card">
                        <h4>Peak Activity</h4>
                        <div class="summary-value" id="peakActivity">N/A</div>
                    </div>
                </div>

                <div class="traffic-charts">
                    <div class="chart-container">
                        <h3>Network Traffic Timeline</h3>
                        <canvas id="trafficChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Port Activity Trends</h3>
                        <canvas id="portTrendsChart"></canvas>
                    </div>
                </div>

                <div class="top-ports">
                    <h3>Top Traffic Ports</h3>
                    <div id="topPortsList"></div>
                </div>
            </div>

            <div class="tab-content" id="topology-tab">
                <div class="topology-container">
                    <div class="topology-controls">
                        <button class="btn btn-sm" id="zoomInBtn"><i class="fas fa-search-plus"></i></button>
                        <button class="btn btn-sm" id="zoomOutBtn"><i class="fas fa-search-minus"></i></button>
                        <button class="btn btn-sm" id="fitBtn"><i class="fas fa-expand"></i></button>
                    </div>
                    <div id="networkTopology"></div>
                </div>
            </div>

            <div class="tab-content" id="docker-tab">
                <div class="docker-containers" id="dockerContainers">
                </div>
            </div>
        </main>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="closeSettingsBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>Auto Refresh</h3>
                    <label class="switch">
                        <input type="checkbox" id="autoRefreshToggle" checked>
                        <span class="slider"></span>
                    </label>
                    <div class="setting-item">
                        <label for="refreshInterval">Refresh Interval (seconds):</label>
                        <input type="number" id="refreshInterval" value="10" min="5" max="60">
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Notifications</h3>
                    <label class="switch">
                        <input type="checkbox" id="notificationsToggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-section">
                    <h3>Data Retention</h3>
                    <div class="setting-item">
                        <label for="dataRetention">Keep history for (days):</label>
                        <input type="number" id="dataRetention" value="30" min="1" max="365">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.6/dist/vis-network.min.js"
            onload="console.log('vis.js loaded successfully')"
            onerror="console.error('Failed to load vis.js from CDN')"></script>
    <script>
        // Fallback for vis.js if CDN fails
        if (typeof vis === 'undefined') {
            console.warn('vis.js not loaded, topology will use fallback visualization');
        }
    </script>
    <script src="app.js"></script>
</body>
</html>